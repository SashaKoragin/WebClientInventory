<h1>Пользователи</h1>
<mat-tab-group [style.display]="isload ? 'none' : 'grid'">
    <mat-tab label="Все пользователи">
        <div class="mat-elevation-z8">
            <form class="search">
                <mat-form-field class="search_blok">
                    <span matPrefix><i class="material-icons">youtube_searched_for</i></span>
                    <input matInput (keyup)="user.filterstable($event.target.value)" placeholder="Поиск данных">
                </mat-form-field>
                <button class="actual" mat-button (click)="telephoneHelp()">Сформировать справочник</button>
                <button class="actual" mat-button (click)="excel.ExportTOExcel(tableusers)">Выгрузить
                    пользователей</button>
                <ng-template [ngxPermissionsExcept]="['Просмотр','Безопасность']">
                    <button class="actual" mat-button (click)="actualUsers()">Актулизация пользователей</button>
                </ng-template>
                <button class="actual" mat-button (click)="createReportCard()">Сформировать табель</button>
                <label>{{serveranswer}}</label>
            </form>

            <div class="tables" #TABLEUSERS>
                <table mat-table [dataSource]="user.dataSource" matSort>
                    <ng-container matColumnDef="Logic">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Заявки</th>
                        <td [style.background]="row.StatusUser?.ColorStatus" mat-cell *matCellDef="let row">
                            <ng-template [ngxPermissionsExcept]="['Просмотр','Безопасность']">
                                <button mat-icon-button [matMenuTriggerFor]="menu" color="primary" matTooltip="Меню">
                                    <mat-icon>more_vert</mat-icon>
                                    <mat-menu #menu="matMenu">
                                        <div class="MenuButton"
                                            *ngFor="let template of selectall.select.FullTemplateSupport | filters:[5,6]">
                                            <button mat-menu-item
                                                (click)="user.createSTO(row,template,authService,dialog)"
                                                [matTooltip]="template.InfoTemplate">
                                                <mat-icon>input</mat-icon>
                                                {{template.Name}}
                                            </button>
                                        </div>
                                    </mat-menu>
                                </button>
                            </ng-template>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="IdUser">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Id</th>
                        <td [style.background]="row.StatusUser?.ColorStatus" mat-cell *matCellDef="let row"
                            [matTooltip]="row.IdUser">{{row.IdUser}}</td>
                    </ng-container>

                    <ng-container matColumnDef="Name">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Имя пользователя</th>
                        <td [style.background]="row.StatusUser?.ColorStatus" mat-cell *matCellDef="let row"
                            [matTooltip]="row.Name">
                            <Label [style.display]="row.ModelIsEdit ? 'none':'inline'">{{row.Name}}</Label>
                            <div [ngClass]=row.IdUser.toString() id="{{row.IdUser}}"
                                [style.display]="!row.ModelIsEdit ? 'none':'block'">
                            </div>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="TabelNumber">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Табельный номер</th>
                        <td [style.background]="row.StatusUser?.ColorStatus" mat-cell *matCellDef="let row"
                            [matTooltip]="row.TabelNumber">
                            <Label [style.display]="row.ModelIsEdit ? 'none':'inline'">{{row.TabelNumber}}</Label>
                            <div [ngClass]=row.IdUser.toString() id="{{row.IdUser}}"
                                [style.display]="!row.ModelIsEdit ? 'none':'block'">
                            </div>
                        </td>
                    </ng-container>


                    <ng-container matColumnDef="Telephon.SerNumber">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Серийный номер телефона</th>
                        <td [style.background]="row.StatusUser?.ColorStatus" mat-cell *matCellDef="let row"
                            [matTooltip]="row.Telephon?.SerNumber">
                            <Label
                                [style.display]="row.ModelIsEdit ? 'none':'inline'">{{row.Telephon?.SerNumber}}</Label>
                            <div [ngClass]=row.IdUser.toString() id="{{row.IdUser}}"
                                [style.display]="!row.ModelIsEdit ? 'none':'block'">
                            </div>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="Telephon.Telephon_">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Внутренний номер</th>
                        <td [style.background]="row.StatusUser?.ColorStatus" mat-cell *matCellDef="let row"
                            [matTooltip]="row.Telephon?.Telephon_">
                            <Label
                                [style.display]="row.ModelIsEdit ? 'none':'inline'">{{row.Telephon?.Telephon_}}</Label>
                            <div [ngClass]=row.IdUser.toString() id="{{row.IdUser}}"
                                [style.display]="!row.ModelIsEdit ? 'none':'block'">
                            </div>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="Telephon.TelephonUndeground">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Городской номер</th>
                        <td [style.background]="row.StatusUser?.ColorStatus" mat-cell *matCellDef="let row"
                            [matTooltip]="row.Telephon?.TelephonUndeground">
                            <Label
                                [style.display]="row.ModelIsEdit ? 'none':'inline'">{{row.Telephon?.TelephonUndeground}}</Label>
                            <div [style.display]="!row.ModelIsEdit ? 'none':'block'">
                                <label>{{user.model?.Telephon?.TelephonUndeground}}</label>
                            </div>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="Position.NamePosition">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Должность</th>
                        <td [style.background]="row.StatusUser?.ColorStatus" mat-cell *matCellDef="let row"
                            [matTooltip]="row.Position?.NamePosition">
                            <Label
                                [style.display]="row.ModelIsEdit ? 'none':'inline'">{{row.Position?.NamePosition}}</Label>
                            <div [ngClass]=row.IdUser.toString() id="{{row.IdUser}}"
                                [style.display]="!row.ModelIsEdit ? 'none':'block'">
                            </div>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="Otdel.NameOtdel">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Отдел</th>
                        <td [style.background]="row.StatusUser?.ColorStatus" mat-cell *matCellDef="let row"
                            [matTooltip]="row.Otdel?.NameOtdel">
                            <Label [style.display]="row.ModelIsEdit ? 'none':'inline'">{{row.Otdel?.NameOtdel}}</Label>
                            <div [ngClass]=row.IdUser.toString() id="{{row.IdUser}}"
                                [style.display]="!row.ModelIsEdit ? 'none':'block'">
                            </div>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="StatusActual">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Актуальность</th>
                        <td [style.background]="row.StatusUser?.ColorStatus" mat-cell *matCellDef="let row">
                            {{row.StatusUser?.StatusText}}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="ActionsColumn">
                        <th mat-header-cell *matHeaderCellDef>
                            <ng-template [ngxPermissionsExcept]="['Оператор','Просмотр','Безопасность']">
                                <button mat-icon-button color="primary" [disabled]="user.isAdd" focusable="false"
                                    (click)="user.add()">
                                    <i class="material-icons">person_add</i>
                                </button>
                            </ng-template>
                        </th>
                        <td [style.background]="row.StatusUser?.ColorStatus" mat-cell *matCellDef="let row">
                            <ng-template [ngxPermissionsExcept]="['Просмотр','Безопасность']">
                                <button mat-icon-button *ngIf="!row.ModelIsEdit" [disabled]="user.isEdit" color="accent"
                                    (click)="user.edit(row)">
                                    <i class="material-icons">edit</i>
                                </button>
                            </ng-template>
                            <ng-template [ngxPermissionsExcept]="['Просмотр','Оператор','Редактор','Безопасность']">
                                <button mat-icon-button *ngIf="!row.ModelIsEdit" [disabled]="user.isEdit"
                                    (click)="user.delete(row)">
                                    <i class="material-icons">delete</i>
                                </button>
                            </ng-template>
                            <div *ngIf="row.ModelIsEdit">
                                <button mat-icon-button type="submit"
                                    [disabled]="user.modelvalid.getRowValidatorModel[0].invalid" color="primary"
                                    focusable="false" (click)="user.save()">
                                    <i class="material-icons">check</i>
                                </button>
                                <button mat-icon-button color="primary" focusable="false" (click)="user.cancel(row)">
                                    <i class="material-icons">cancel</i>
                                </button>
                            </div>
                        </td>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="user.displayedColumns; sticky: true"></tr>
                    <tr mat-row *matRowDef="let row; columns: user.displayedColumns;"></tr>
                </table>
            </div>
            <mat-paginator #users [pageSizeOptions]="[10, 20, 50, paginator.length]" showFirstLastButtons="true">
            </mat-paginator>
            <div class="procedure">
                <label>Последняя актулизация:</label>
                <table mat-table [dataSource]="dataSource" *ngIf="dataSource.data.length > 0">
                    <ng-container matColumnDef="Id">
                        <th mat-header-cell *matHeaderCellDef>Id</th>
                        <td mat-cell *matCellDef="let row" [matTooltip]="row.Id"> {{row.Id}} </td>
                    </ng-container>
                    <ng-container matColumnDef="ChangeType">
                        <th mat-header-cell *matHeaderCellDef>Действия процедуры</th>
                        <td mat-cell *matCellDef="let row" [matTooltip]="row.ChangeType"> {{row.ChangeType}} </td>
                    </ng-container>
                    <ng-container matColumnDef="IdUser">
                        <th mat-header-cell *matHeaderCellDef>Ун пользователя</th>
                        <td mat-cell *matCellDef="let row" [matTooltip]="row.IdUser"> {{row.IdUser}} </td>
                    </ng-container>
                    <ng-container matColumnDef="NameUsers">
                        <th mat-header-cell *matHeaderCellDef>Имя</th>
                        <td mat-cell *matCellDef="let row" [matTooltip]="row.NameUsers"> {{row.NameUsers}} </td>
                    </ng-container>
                    <ng-container matColumnDef="SmallNameUsers">
                        <th mat-header-cell *matHeaderCellDef>Сокр. Имя</th>
                        <td mat-cell *matCellDef="let row" [matTooltip]="row.SmallNameUsers"> {{row.SmallNameUsers}}
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="IdOtdel">
                        <th mat-header-cell *matHeaderCellDef>Ун отдела</th>
                        <td mat-cell *matCellDef="let row" [matTooltip]="row.IdOtdel"> {{row.IdOtdel}} </td>
                    </ng-container>
                    <ng-container matColumnDef="IdPosition">
                        <th mat-header-cell *matHeaderCellDef>Ун должности</th>
                        <td mat-cell *matCellDef="let row" [matTooltip]="row.IdPosition"> {{row.IdPosition}} </td>
                    </ng-container>
                    <ng-container matColumnDef="TabelNumber">
                        <th mat-header-cell *matHeaderCellDef>Табельный номер</th>
                        <td mat-cell *matCellDef="let row" [matTooltip]="row.TabelNumber"> {{row.TabelNumber}} </td>
                    </ng-container>
                    <ng-container matColumnDef="StatusActual">
                        <th mat-header-cell *matHeaderCellDef>Актуальный статус</th>
                        <td mat-cell *matCellDef="let row"> {{row.StatusActual}} </td>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                </table>
                <div *ngIf="dataSource.data.length === 0">Отсутствуют данные!!!</div>
            </div>
        </div>

        <div [style.display]="'none'" #TEMPLATEUSERS>
            <mat-form-field id="template" class="validation">
                <input class="input" matInput [formControl]="user.modelvalid?.getRowValidatorModel[0].get('Name')"
                    placeholder="Имя пользователя" [ngModel]="user.model?.Name"
                    (ngModelChange)="user.model.Name = $event" />
            </mat-form-field>

            <mat-form-field id="template" class="validation">
                <input matInput [formControl]="user.modelvalid?.getRowValidatorModel[0].get('TabelNumber')"
                    placeholder="Табельный номер" [ngModel]="user.model?.TabelNumber"
                    (ngModelChange)="user.model.TabelNumber = $event" />
            </mat-form-field>

            <mat-form-field id="template" class="validation">
                <mat-select (click)="user.calbackfiltersAll()" [placeholder]="user.model.Telephon?.SerNumber"
                    [(ngModel)]="user.model.Telephon" name="telephon">
                    <mat-select-filter class="filter" [placeholder]="user.model.Telephon?.SerNumber"
                        [displayMember]="'SerNumber'" [array]="user.telephone"
                        (filteredReturn)="user.filteredTelephone =$event">
                    </mat-select-filter>
                    <mat-option [value]='null'>None</mat-option>
                    <mat-option *ngFor="let telephon of user.filteredTelephone" [value]="telephon">
                        {{telephon.SerNumber}}
                    </mat-option>
                </mat-select>
            </mat-form-field>

            <mat-form-field id="template" class="validation">
                <mat-select (click)="user.calbackfiltersAll()" [placeholder]="user.model.Telephon?.Telephon_"
                    [(ngModel)]="user.model.Telephon" name="telephon">
                    <mat-select-filter class="filter" [placeholder]="user.model.Telephon?.Telephon_"
                        [displayMember]="'Telephon_'" [array]="user.telephone"
                        (filteredReturn)="user.filteredTelephone =$event">
                    </mat-select-filter>
                    <mat-option [value]='null'>None</mat-option>
                    <mat-option *ngFor="let telephon of user.filteredTelephone" [value]="telephon">
                        {{telephon.Telephon_}}
                    </mat-option>
                </mat-select>
            </mat-form-field>

            <mat-form-field id="template" class="validation">
                <mat-select (click)="user.calbackfiltersAll()"
                    [formControl]="user.modelvalid?.getRowValidatorModel[0].get('NamePosition')"
                    [placeholder]="user.model.Position?.NamePosition" [(ngModel)]="user.model.Position" name="position">
                    <mat-select-filter class="filter" [placeholder]="user.model.Position?.NamePosition"
                        [displayMember]="'NamePosition'" [array]="user.position"
                        (filteredReturn)="user.filteredPosition =$event">
                    </mat-select-filter>
                    <mat-option [value]='null'>None</mat-option>
                    <mat-option *ngFor="let position of user. filteredPosition" [value]="position">
                        {{position.NamePosition}}
                    </mat-option>
                </mat-select>
            </mat-form-field>

            <mat-form-field id="template" class="validation">
                <mat-select (click)="user.calbackfiltersAll()"
                    [formControl]="user.modelvalid?.getRowValidatorModel[0].get('NameOtdel')"
                    [placeholder]="user.model.Otdel?.NameOtdel" [(ngModel)]="user.model.Otdel" name="otdel">
                    <mat-select-filter class="filter" [placeholder]="user.model.Otdel?.NameOtdel"
                        [displayMember]="'NameOtdel'" [array]="user.otdels"
                        (filteredReturn)="user.filteredOtdel =$event">
                    </mat-select-filter>
                    <mat-option [value]='null'>None</mat-option>
                    <mat-option *ngFor="let otdel of user.filteredOtdel" [value]="otdel">
                        {{otdel.NameOtdel}}
                    </mat-option>
                </mat-select>
            </mat-form-field>

        </div>
    </mat-tab>
    <mat-tab label="Отделы/Начальники">
        <div class="mat-elevation-z8">
            <form class="search">
                <mat-form-field class="search_blok">
                    <span matPrefix><i class="material-icons">youtube_searched_for</i></span>
                    <input matInput (keyup)="otdel.filterstable($event.target.value)" placeholder="Поиск данных">
                </mat-form-field>
                <button class="actual" mat-button (click)="excel.ExportTOExcel(tableotdels)">Выгрузить отделы и
                    начальников</button>
            </form>
            <div class="tables" #TABLEOTDELS>
                <table mat-table [dataSource]="otdel.dataSource">
                    <ng-container matColumnDef="IdOtdel">
                        <th mat-header-cell *matHeaderCellDef>Id</th>
                        <td mat-cell *matCellDef="let row">
                            {{row.IdOtdel}}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="CodeOtdel">
                        <th mat-header-cell *matHeaderCellDef>Код отдела</th>
                        <td mat-cell *matCellDef="let row">
                            <Label [style.display]="row.ModelIsEdit ? 'none':'block'">{{row.CodeOtdel}}</Label>
                            <div [ngClass]=row.IdOtdel.toString() id="{{row.IdOtdel}}"
                                [style.display]="!row.ModelIsEdit ? 'none':'block'">

                            </div>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="NameOtdel">
                        <th mat-header-cell *matHeaderCellDef>Наименование отдела</th>
                        <td mat-cell *matCellDef="let row">
                            <Label [style.display]="row.ModelIsEdit ? 'none':'block'">{{row.NameOtdel}}</Label>
                            <div [ngClass]=row.IdOtdel.toString() id="{{row.IdOtdel}}"
                                [style.display]="!row.ModelIsEdit ? 'none':'block'">

                            </div>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="NameRuk">
                        <th mat-header-cell *matHeaderCellDef>ФИО Начальника отдела</th>
                        <td mat-cell *matCellDef="let row">
                            <Label [style.display]="row.ModelIsEdit ? 'none':'inline'">{{row.User?.Name}}</Label>
                            <div [ngClass]=row.IdOtdel.toString() id="{{row.IdOtdel}}"
                                [style.display]="!row.ModelIsEdit ? 'none':'block'">

                            </div>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="ActionsColumn">
                        <th mat-header-cell *matHeaderCellDef>
                            <ng-template [ngxPermissionsExcept]="['Оператор','Просмотр','Безопасность']">
                                <button mat-icon-button color="primary" [disabled]="otdel.isAdd" focusable="false"
                                    (click)="otdel.add()">
                                    <i class="material-icons">person_add</i>
                                </button>
                            </ng-template>
                        </th>
                        <td mat-cell *matCellDef="let row">
                            <ng-template [ngxPermissionsExcept]="['Просмотр','Безопасность']">
                                <button mat-icon-button *ngIf="!row.ModelIsEdit" [disabled]="otdel.isEdit"
                                    color="accent" (click)="otdel.edit(row)">
                                    <i class="material-icons">edit</i>
                                </button>
                            </ng-template>
                            <div *ngIf="row.ModelIsEdit">
                                <button mat-icon-button type="submit" color="primary" focusable="false"
                                    (click)="otdel.save()">
                                    <i class="material-icons">check</i>
                                </button>
                                <button mat-icon-button color="primary" focusable="false" (click)="otdel.cancel(row)">
                                    <i class="material-icons">cancel</i>
                                </button>
                            </div>
                        </td>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="otdel.displayedColumns; sticky: true"></tr>
                    <tr mat-row *matRowDef="let row; columns: otdel.displayedColumns;"></tr>
                </table>
            </div>
            <mat-paginator class="paginator" #otdels [pageSizeOptions]="[10, 20, 50, paginatorotdels.length]"
                showFirstLastButtons="true"></mat-paginator>
        </div>


        <div [style.display]="'none'" #TEMPLATEOTDELS>

            <mat-form-field id="template" class="validation">
                <input matInput placeholder="Код отдела" [ngModel]="otdel.model?.CodeOtdel"
                    (ngModelChange)="otdel.model.CodeOtdel= $event" />
            </mat-form-field>

            <mat-form-field id="template" class="validation">
                <input matInput placeholder="Наименование отдела" [ngModel]="otdel.model?.NameOtdel"
                    (ngModelChange)="otdel.model.NameOtdel = $event" />
            </mat-form-field>

            <mat-form-field id="template" class="validation">
                <mat-select (click)="otdel.calbackfiltersAll()" [placeholder]="otdel.model.User?.Name"
                    [(ngModel)]="otdel.model.User" name="user">
                    <mat-select-filter class="filter" [placeholder]="otdel.model.User?.Name" [displayMember]="'Name'"
                        [array]="otdel.user" (filteredReturn)="otdel.filteredUser =$event">
                    </mat-select-filter>
                    <mat-option [value]='null'>None</mat-option>
                    <mat-option *ngFor="let user of otdel.filteredUser" [value]="user">
                        {{user.Name}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </div>
    </mat-tab>
    <mat-tab label="Телефоны">
        <div class="mat-elevation-z8">
            <form class="search">
                <mat-form-field class="search_blok">
                    <span matPrefix><i class="material-icons">youtube_searched_for</i></span>
                    <input matInput (keyup)="telephone.filterstable($event.target.value)" placeholder="Поиск данных">
                </mat-form-field>
                <button class="actual" mat-button (click)="excel.ExportTOExcel(tabletelephones)">Выгрузить
                    телефоны</button>
                <button class="actual" mat-button (click)="getTelephoneFull()">Запрос по всем привязанным
                    телефонам</button>
            </form>
            <div class="tables" #TABLETELEPHONES>
                <table mat-table [dataSource]="telephone.dataSource" matSort>

                    <ng-container matColumnDef="Logic">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Заявки</th>
                        <td [style.background]="row.Statusing?.Color" mat-cell *matCellDef="let row">
                            <ng-template [ngxPermissionsExcept]="['Просмотр','Безопасность']">
                                <button mat-icon-button [matMenuTriggerFor]="menu" color="primary" matTooltip="Меню">
                                    <mat-icon>more_vert</mat-icon>
                                    <mat-menu #menu="matMenu">
                                        <div class="MenuButton"
                                            *ngFor="let template of selectall.select.FullTemplateSupport | filters:[6]">
                                            <button mat-menu-item
                                                (click)="telephone.createSTO(row,template,authService,dialog)"
                                                [matTooltip]="template.InfoTemplate">
                                                <mat-icon>input</mat-icon>
                                                {{template.Name}}
                                            </button>
                                        </div>
                                    </mat-menu>
                                </button>
                            </ng-template>
                            <button mat-icon-button color="primary" matTooltip="Сформировать QR код"
                                (click)="createQRCode(row.SerNumber)">
                                <i class="material-icons">print</i>
                            </button>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="IdTelephone">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Id</th>
                        <td [style.background]="row.Statusing?.Color" mat-cell *matCellDef="let row"
                            [matTooltip]="row.IdTelephon">{{row.IdTelephon}}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="Supply.DatePostavki">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Фактическая дата поставки</th>
                        <td [style.background]="row.Statusing?.Color" mat-cell *matCellDef="let row">
                            <Label
                                [style.display]="row.ModelIsEdit ? 'none':'inline'">{{datetemplate(row.Supply?.DatePostavki)}}</Label>
                            <div [ngClass]=row.IdTelephon.toString() id="{{row.IdTelephon}}"
                                [style.display]="!row.ModelIsEdit ? 'none':'block'">
                            </div>
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="NameTelephone">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Наименование</th>
                        <td [style.background]="row.Statusing?.Color" mat-cell *matCellDef="let row"
                            [matTooltip]="row?.NameTelephone">
                            <Label [style.display]="row.ModelIsEdit ? 'none':'inline'">{{row?.NameTelephone}}</Label>
                            <div [ngClass]=row.IdTelephon.toString() id="{{row.IdTelephon}}"
                                [style.display]="!row.ModelIsEdit ? 'none':'block'">
                            </div>
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="Telephon_">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Телефон внутренний</th>
                        <td [style.background]="row.Statusing?.Color" mat-cell *matCellDef="let row"
                            [matTooltip]="row?.Telephon_">
                            <Label [style.display]="row.ModelIsEdit ? 'none':'inline'">{{row?.Telephon_}}</Label>
                            <div [ngClass]=row.IdTelephon.toString() id="{{row.IdTelephon}}"
                                [style.display]="!row.ModelIsEdit ? 'none':'block'">
                            </div>
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="TelephonUndeground">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Телефон городской</th>
                        <td [style.background]="row.Statusing?.Color" mat-cell *matCellDef="let row"
                            [matTooltip]="row?.TelephonUndeground">
                            <Label
                                [style.display]="row.ModelIsEdit ? 'none':'inline'">{{row?.TelephonUndeground}}</Label>
                            <div [ngClass]=row.IdTelephon.toString() id="{{row.IdTelephon}}"
                                [style.display]="!row.ModelIsEdit ? 'none':'block'">
                            </div>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="ServiceNum">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Сервисный номер</th>
                        <td [style.background]="row.Statusing?.Color" mat-cell *matCellDef="let row"
                            [matTooltip]="row?.ServiceNum">
                            <Label [style.display]="row.ModelIsEdit ? 'none':'inline'">{{row?.ServiceNum}}</Label>
                            <div [ngClass]=row.IdTelephon.toString() id="{{row.IdTelephon}}"
                                [style.display]="!row.ModelIsEdit ? 'none':'block'">
                            </div>
                        </td>
                    </ng-container>


                    <ng-container matColumnDef="SerNumber">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Сирийный номер</th>
                        <td [style.background]="row.Statusing?.Color" mat-cell *matCellDef="let row"
                            [matTooltip]="row?.SerNumber">
                            <Label [style.display]="row.ModelIsEdit ? 'none':'inline'">{{row?.SerNumber}}</Label>
                            <div [ngClass]=row.IdTelephon.toString() id="{{row.IdTelephon}}"
                                [style.display]="!row.ModelIsEdit ? 'none':'block'">
                            </div>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="InventarNum">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Инвентарный номер</th>
                        <td [style.background]="row.Statusing?.Color" mat-cell *matCellDef="let row"
                            [matTooltip]="row?.InventarNum ">
                            <Label [style.display]="row.ModelIsEdit ? 'none':'inline'">{{row?.InventarNum }}</Label>
                            <div [ngClass]=row.IdTelephon.toString() id="{{row.IdTelephon}}"
                                [style.display]="!row.ModelIsEdit ? 'none':'block'">
                            </div>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="IpTelephon">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Ip Адрес</th>
                        <td [style.background]="row.Statusing?.Color" mat-cell *matCellDef="let row"
                            [matTooltip]="row?.IpTelephon">
                            <Label [style.display]="row.ModelIsEdit ? 'none':'inline'">{{row?.IpTelephon}}</Label>
                            <div [ngClass]=row.IdTelephon.toString() id="{{row.IdTelephon}}"
                                [style.display]="!row.ModelIsEdit ? 'none':'block'">
                            </div>
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="MacTelephon">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>MAC Адрес</th>
                        <td [style.background]="row.Statusing?.Color" mat-cell *matCellDef="let row"
                            [matTooltip]="row?.MacTelephon">
                            <Label [style.display]="row.ModelIsEdit ? 'none':'inline'">{{row?.MacTelephon}}</Label>
                            <div [ngClass]=row.IdTelephon.toString() id="{{row.IdTelephon}}"
                                [style.display]="!row.ModelIsEdit ? 'none':'block'">
                            </div>
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="Kabinet.NumberKabinet">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Кабинет</th>
                        <td [style.background]="row.Statusing?.Color" mat-cell *matCellDef="let row"
                            [matTooltip]="row?.Kabinet?.NumberKabinet">
                            <Label
                                [style.display]="row.ModelIsEdit ? 'none':'inline'">{{row?.Kabinet?.NumberKabinet}}</Label>
                            <div [ngClass]=row.IdTelephon.toString() id="{{row.IdTelephon}}"
                                [style.display]="!row.ModelIsEdit ? 'none':'block'">
                            </div>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="Coment">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Коментарий</th>
                        <td [style.background]="row.Statusing?.Color" mat-cell *matCellDef="let row"
                            [matTooltip]="row.Coment">
                            <Label [style.display]="row.ModelIsEdit ? 'none':'inline'">{{row.Coment}}</Label>
                            <div [ngClass]=row.IdTelephon.toString() id="{{row.IdTelephon}}"
                                [style.display]="!row.ModelIsEdit ? 'none':'block'">
                            </div>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="Statusing.Name">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Статус</th>
                        <td [style.background]="row.Statusing?.Color" mat-cell *matCellDef="let row"
                            [matTooltip]="row.Statusing?.Name">
                            <Label [style.display]="row.ModelIsEdit ? 'none':'inline'">{{row.Statusing?.Name}}</Label>
                            <div [ngClass]=row.IdTelephon.toString() id="{{row.IdTelephon}}"
                                [style.display]="!row.ModelIsEdit ? 'none':'block'">
                            </div>
                        </td>
                    </ng-container>


                    <ng-container matColumnDef="ActionsColumn">
                        <th mat-header-cell *matHeaderCellDef>
                            <ng-template [ngxPermissionsExcept]="['Оператор','Просмотр','Безопасность']">
                                <button mat-icon-button color="primary" [disabled]="telephone.isAdd" focusable="false"
                                    (click)="telephone.add()">
                                    <i class="material-icons">person_add</i>
                                </button>
                            </ng-template>
                        </th>
                        <td [style.background]="row.Statusing?.Color" mat-cell *matCellDef="let row">
                            <ng-template [ngxPermissionsExcept]="['Просмотр','Безопасность']">
                                <button mat-icon-button *ngIf="!row.ModelIsEdit" [disabled]="telephone.isEdit"
                                    color="accent" (click)="telephone.edit(row)">
                                    <i class="material-icons">edit</i>
                                </button>
                            </ng-template>
                            <ng-template [ngxPermissionsExcept]="['Просмотр','Оператор','Редактор','Безопасность']">
                                <button mat-icon-button *ngIf="!row.ModelIsEdit" [disabled]="telephone.isEdit"
                                    (click)="telephone.delete(row)">
                                    <i class="material-icons">delete</i>
                                </button>
                            </ng-template>
                            <div *ngIf="row.ModelIsEdit">
                                <button mat-icon-button type="submit"
                                    [disabled]="telephone.modelvalid.getRowValidatorModel[4].invalid" color="primary"
                                    focusable="false" (click)="telephone.save()">
                                    <i class="material-icons">check</i>
                                </button>
                                <button mat-icon-button color="primary" focusable="false"
                                    (click)="telephone.cancel(row)">
                                    <i class="material-icons">cancel</i>
                                </button>
                            </div>
                        </td>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="telephone.displayedColumns; sticky: true"></tr>
                    <tr mat-row *matRowDef="let row; columns: telephone.displayedColumns;"></tr>
                </table>
            </div>
            <mat-paginator class="paginator" #telephones [pageSizeOptions]="[5, 10, 25, paginatortelephones.length]"
                showFirstLastButtons="true"></mat-paginator>
        </div>

        <div [style.display]="'none'" #TEMPLATETELEPHONE>

            <mat-form-field id="template" class="validation">
                <mat-select (click)="telephone.calbackfiltersAll()" [placeholder]="telephone.model.Supply?.DatePostavki"
                    [(ngModel)]="telephone.model.Supply" name="supply">
                    <mat-select-filter class="filter" [placeholder]="telephone.model.Supply?.DatePostavki"
                        [displayMember]="'DatePostavki'" [array]="telephone.supples"
                        (filteredReturn)="telephone.filteredSupples =$event">
                    </mat-select-filter>
                    <mat-option [value]='null'>None</mat-option>
                    <mat-option *ngFor="let supply of telephone.filteredSupples" [value]="supply">
                        {{datetemplate(supply?.DatePostavki)}}
                    </mat-option>
                </mat-select>
            </mat-form-field>

            <mat-form-field id="template" class="validation">
                <input matInput [formControl]="telephone.modelvalid?.getRowValidatorModel[4].get('NameTelephone')"
                    placeholder="Наименование" [ngModel]="telephone.model?.NameTelephone"
                    (ngModelChange)="telephone.model.NameTelephone = $event" />
            </mat-form-field>

            <mat-form-field id="template" class="validation">
                <input matInput
                    placeholder="Телефон внутренний" [ngModel]="telephone.model?.Telephon_"
                    (ngModelChange)="telephone.model.Telephon_ = $event" />
            </mat-form-field>

            <mat-form-field id="template" class="validation">
                <input matInput placeholder="Телефон городской" [ngModel]="telephone.model?.TelephonUndeground"
                    (ngModelChange)="telephone.model.TelephonUndeground = $event" />
            </mat-form-field>

            <mat-form-field id="template" class="validation">
                <input matInput placeholder="Сервисный номер" [ngModel]="telephone.model?.ServiceNum"
                    (ngModelChange)="telephone.model.ServiceNum = $event" />
            </mat-form-field>


            <mat-form-field id="template" class="validation">
                <input matInput [formControl]="telephone.modelvalid?.getRowValidatorModel[4].get('SerNumber')"
                    placeholder="Сирийный номер" [ngModel]="telephone.model?.SerNumber"
                    (ngModelChange)="telephone.model.SerNumber = $event" />
            </mat-form-field>

            <mat-form-field id="template" class="validation">
                <input matInput placeholder="Инвентарный номер" [ngModel]="telephone.model?.InventarNum"
                    (ngModelChange)="telephone.model.InventarNum = $event" />
            </mat-form-field>

            <mat-form-field id="template" class="validation">
                <input matInput
                    placeholder="Ip Адрес" [ngModel]="telephone.model?.IpTelephon"
                    (ngModelChange)="telephone.model.IpTelephon = $event" />
            </mat-form-field>

            <mat-form-field id="template" class="validation">
                <input matInput [formControl]="telephone.modelvalid?.getRowValidatorModel[4].get('MacTelephone')"
                    placeholder="MAC Адрес" [ngModel]="telephone?.model?.MacTelephon"
                    (ngModelChange)="telephone?.model.MacTelephon = $event" />
            </mat-form-field>

            <mat-form-field id="template" class="validation">
                <mat-select (click)="telephone.calbackfiltersAll()"
                    [placeholder]="telephone.model.Kabinet?.NumberKabinet" [(ngModel)]="telephone.model.Kabinet"
                    name="kabinet">
                    <mat-select-filter class="filter" [placeholder]="telephone?.model.Kabinet?.NumberKabinet"
                        [displayMember]="'NumberKabinet'" [array]="telephone.kabinet"
                        (filteredReturn)="telephone.filteredKabinet =$event">
                    </mat-select-filter>
                    <mat-option [value]='null'>None</mat-option>
                    <mat-option *ngFor="let kabinet of telephone.filteredKabinet" [value]="kabinet">
                        {{kabinet.NumberKabinet}}
                    </mat-option>
                </mat-select>
            </mat-form-field>

            <mat-form-field id="template" class="validation">
                <input matInput placeholder="Коментарий" [ngModel]="telephone.model?.Coment"
                    (ngModelChange)="telephone.model.Coment = $event" />
            </mat-form-field>

            <mat-form-field id="template" class="validation">
                <mat-select (click)="telephone.calbackfiltersAll()" [placeholder]="telephone.model.Statusing?.Name"
                    [(ngModel)]="telephone.model.Statusing" name="status">
                    <mat-select-filter class="filter" [placeholder]="telephone.model.Statusing?.Name"
                        [array]="telephone.statusing" (filteredReturn)="telephone.filteredStatusing =$event">
                    </mat-select-filter>
                    <mat-option [value]='null'>None</mat-option>
                    <mat-option *ngFor="let status of telephone.filteredStatusing" [value]="status">
                        {{status.Name}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </div>
    </mat-tab>
    <mat-tab label="Роли пользователей">
        <div class="modeltable">
            <div class="modelUser">
                <form class="search">
                    <mat-form-field class="search_blok">
                        <span matPrefix><i class="material-icons">youtube_searched_for</i></span>
                        <input matInput (keyup)="roleAndUser.filterstableUser($event.target.value)"
                            placeholder="Поиск пользователя">
                    </mat-form-field>
                </form>
                <div class="tables" #TABLEMODELRULES>
                    <table mat-table [dataSource]="roleAndUser.dataSourceUser" matSort>
                        <ng-container matColumnDef="Select">
                            <th mat-header-cell *matHeaderCellDef>Выбор</th>
                            <td mat-cell *matCellDef="let row">
                                <ng-template ngxPermissionsOnly="Администратор">
                                    <mat-checkbox (click)="$event.stopPropagation();"
                                        (change)="roleAndUser.selectionUsers.toggle(row);roleAndUser.selectUserDb()"
                                        [checked]="roleAndUser.selectionUsers.isSelected(row)">
                                    </mat-checkbox>
                                </ng-template>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="NameUser">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>Имя пользователя</th>
                            <td mat-cell *matCellDef="let row">{{row.Name}}</td>
                        </ng-container>

                        <ng-container matColumnDef="TabelNumber">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>Табельный номер</th>
                            <td mat-cell *matCellDef="let row">{{row.TabelNumber}}</td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="roleAndUser.displayedColumnsUser; sticky: true"></tr>
                        <tr mat-row *matRowDef="let row; columns: roleAndUser.displayedColumnsUser;"></tr>
                    </table>
                </div>
                <mat-paginator class="paginator" #userRoles [pageSizeOptions]="[10, 20, 50]"
                    showFirstLastButtons="true"></mat-paginator>
            </div>
            <div class="modelRule">
                <form class="search">
                    <mat-form-field class="search_blok">
                        <span matPrefix><i class="material-icons">youtube_searched_for</i></span>
                        <input matInput (keyup)="roleAndUser.filterstableRule($event.target.value)"
                            placeholder="Поиск роли">
                    </mat-form-field>
                </form>
                <div class="tables">
                    <label>{{roleAndUser.firstUser}}</label>
                    <table mat-table [dataSource]="roleAndUser.dataSourceRule" matSort>
                        <ng-container matColumnDef="Select">
                            <th mat-header-cell *matHeaderCellDef>Добавить/Удалить</th>
                            <td mat-cell *matCellDef="let row">
                                <ng-template ngxPermissionsOnly="Администратор">
                                    <mat-checkbox class="selectRule" (change)="roleAndUser.enableRule(row)"
                                        [checked]="roleAndUser.isChechRule(row)"></mat-checkbox>
                                </ng-template>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="IdRule">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>УН Роли</th>
                            <td mat-cell *matCellDef="let row">{{row.idRuleField}}</td>
                        </ng-container>

                        <ng-container matColumnDef="NameRules">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>Наименование роли</th>
                            <td mat-cell *matCellDef="let row">{{row.nameRulesField}}</td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="roleAndUser.displayedColumnsRule; sticky: true"></tr>
                        <tr mat-row *matRowDef="let row; columns: roleAndUser.displayedColumnsRule;"></tr>
                    </table>
                </div>
                <mat-paginator class="paginator" #roles [pageSizeOptions]="[10, 20, 50]" showFirstLastButtons="true">
                </mat-paginator>
            </div>
        </div>
    </mat-tab>
</mat-tab-group>

<div [style.display]="isload ? 'inline':'none'">
    <p>Идет загрузка данных подождите пожалуйста!!!</p>
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    <div class="messages" *ngFor="let mess of loadMessage">
        <p>{{mess}}</p>
    </div>
</div>