<h1>Пользователи</h1>
<mat-tab-group>
    <mat-tab label="Все пользователи">
 <div class="mat-elevation-z8">
        <form class="search">
        <mat-form-field class="search_blok">
                <span matPrefix><i class="material-icons">youtube_searched_for</i></span>
                <input matInput (keyup)="user.filterstable($event.target.value)" placeholder="Поиск данных">
        </mat-form-field>
           <button class="actual" mat-button (click)="excel.ExportTOExcel(tableusers)">Выгрузить пользователей</button>
           <button class="actual" mat-button (click)="actualUsers()">Актулизация пользователей</button>
           <label >{{serveranswer}}</label>
        </form>
    <div class="tables" #TABLEUSERS >
        <table mat-table [dataSource]="user.dataSource" matSort>
            <ng-container matColumnDef="IdUser">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Id</th>
                <td mat-cell *matCellDef="let row">
                 {{row.IdUser}}
                </td>
            </ng-container>
            <ng-container matColumnDef="Name">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Имя пользователя</th>
                <td mat-cell *matCellDef="let row">
                <Label [style.display]="row.ModelIsEdit ? 'none':'inline'">{{row.Name}}</Label> 
                     <mat-form-field class="validation" [style.display]="!row.ModelIsEdit ? 'none':'block'">
                            <input class="input" matInput [formControl]="user.modelvalid?.getRowValidatorModel[0].get('Name')" placeholder="Имя пользователя" [ngModel]="user.model?.Name" (ngModelChange)="user.model.Name = $event"/>
                     </mat-form-field>  
                </td>
            </ng-container>

            <ng-container matColumnDef="TabelNumber">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Табельный номер</th>
                <td mat-cell *matCellDef="let row">
                   <Label [style.display]="row.ModelIsEdit ? 'none':'inline'">{{row.TabelNumber}}</Label> 
                    <mat-form-field class="number" [style.display]="!row.ModelIsEdit ? 'none':'block'">
                            <input matInput  [formControl]="user.modelvalid?.getRowValidatorModel[0].get('TabelNumber')" placeholder="Табельный номер" [ngModel]="user.model?.TabelNumber" (ngModelChange)="user.model.TabelNumber = $event"/>
                    </mat-form-field>
                </td>
            </ng-container>

            <ng-container matColumnDef="Telephon.Telephon_">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Внутренний номер</th>
                    <td mat-cell *matCellDef="let row">
                       <Label [style.display]="row.ModelIsEdit ? 'none':'inline'">{{row.Telephon?.Telephon_}}</Label> 
                       <mat-form-field class="validation" [style.display]="!row.ModelIsEdit ? 'none':'block'">
                            <mat-select (click)="user.calbackfiltersAll()" [placeholder]="user.model.Telephon?.Telephon_" [(ngModel)]="user.model.Telephon" name="telephon">
                              <mat-select-filter class="filter" [placeholder]="user.model.Telephon?.Telephon_" [displayMember]="'Telephon_'" [array]="user.telephone" (filteredReturn)="user.filteredTelephone =$event">
                              </mat-select-filter>
                                <mat-option [value]='null'>None</mat-option>
                                <mat-option *ngFor="let telephon of user.filteredTelephone" [value]="telephon">
                                    {{telephon.Telephon_}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </td>
                </ng-container>
              

                 <ng-container matColumnDef="Telephon.TelephonUndeground">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Городской номер</th>
                        <td mat-cell *matCellDef="let row">
                         <Label [style.display]="row.ModelIsEdit ? 'none':'inline'">{{row.Telephon?.TelephonUndeground}}</Label> 
                              <label [style.display]="!row.ModelIsEdit ? 'none':'block'" >{{user.model?.Telephon?.TelephonUndeground}}</label>
                        </td>
                </ng-container> 

            <ng-container matColumnDef="Position.NamePosition">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Должность</th>
                <td mat-cell *matCellDef="let row">
                        <Label [style.display]="row.ModelIsEdit ? 'none':'inline'">{{row.Position?.NamePosition}}</Label>
                        <mat-form-field class="validation" [style.display]="!row.ModelIsEdit ? 'none':'block'">
                                <mat-select (click)="user.calbackfiltersAll()" [formControl]="user.modelvalid?.getRowValidatorModel[0].get('NamePosition')" [placeholder]="user.model.Position?.NamePosition" [(ngModel)]="user.model.Position" name="position">
                                  <mat-select-filter class="filter" [placeholder]="user.model.Position?.NamePosition" [displayMember]="'NamePosition'" [array]="user.position" (filteredReturn)="user.filteredPosition =$event">
                                  </mat-select-filter>
                                    <mat-option [value]='null'>None</mat-option>
                                    <mat-option *ngFor="let position of user. filteredPosition" [value]="position">
                                        {{position.NamePosition}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                </td>
            </ng-container>


            <ng-container matColumnDef="Otdel.NameOtdel">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Отдел</th>
                <td mat-cell *matCellDef="let row">
                   <Label [style.display]="row.ModelIsEdit ? 'none':'inline'">{{row.Otdel?.NameOtdel}}</Label>
                   <mat-form-field class="validation" [style.display]="!row.ModelIsEdit ? 'none':'block'">
                        <mat-select (click)="user.calbackfiltersAll()" [formControl]="user.modelvalid?.getRowValidatorModel[0].get('NameOtdel')" [placeholder]="user.model.Otdel?.NameOtdel" [(ngModel)]="user.model.Otdel" name="otdel">
                          <mat-select-filter class="filter" [placeholder]="user.model.Otdel?.NameOtdel" [displayMember]="'NameOtdel'" [array]="user.otdels" (filteredReturn)="user.filteredOtdel =$event">
                          </mat-select-filter>
                            <mat-option [value]='null'>None</mat-option>
                            <mat-option *ngFor="let otdel of user.filteredOtdel" [value]="otdel">
                                {{otdel.NameOtdel}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </td>
            </ng-container>

            <ng-container matColumnDef="StatusActual">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Актуальность</th>
                <td mat-cell *matCellDef="let row">
                        {{(row.StatusActual) ? "Работает" : "Уволен" }}
                </td>
            </ng-container>
 

             <ng-container matColumnDef="ActionsColumn">  
                <th mat-header-cell *matHeaderCellDef>
                    <button mat-icon-button color="primary" [disabled]="user.isAdd" focusable="false" (click)="user.add()">
                        <i class="material-icons">person_add</i>
                    </button>
                </th>
                <td mat-cell *matCellDef="let row">
                <button mat-icon-button *ngIf="!row.ModelIsEdit" [disabled]="user.isEdit" color="accent" (click)="user.edit(row)">
                    <i class="material-icons">edit</i>
                </button>
                <div *ngIf="row.ModelIsEdit" >
                        <button  mat-icon-button type="submit" [disabled]="user.modelvalid.getRowValidatorModel[0].invalid" color="primary" focusable="false" (click)="user.save()">
                                <i class="material-icons">check</i>
                       </button>
                       <button mat-icon-button color="primary" focusable="false" (click)="user.cancel(row)">
                            <i class="material-icons">cancel</i>
                        </button>
                </div>
             </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="user.displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: user.displayedColumns;"></tr>
        </table>
    </div>
        <mat-paginator #users [pageSizeOptions]="[10, 20, 50, paginator.length]" showFirstLastButtons="true"></mat-paginator>
        <div class="procedure">
            <label>Последняя актулизация:</label>
        <table mat-table [dataSource]="dataSource" *ngIf="dataSource.data.length > 0">
            <ng-container matColumnDef="Id">
                <th mat-header-cell *matHeaderCellDef>Id</th>
                <td mat-cell *matCellDef="let row"> {{row.Id}} </td>
            </ng-container>
            <ng-container matColumnDef="ChangeType">
                <th mat-header-cell *matHeaderCellDef>Действия процедуры</th>
                <td mat-cell *matCellDef="let row"> {{row.ChangeType}} </td>
            </ng-container>
            <ng-container matColumnDef="IdUser">
                <th mat-header-cell *matHeaderCellDef>Ун пользователя</th>
                <td mat-cell *matCellDef="let row"> {{row.IdUser}} </td>
            </ng-container>
            <ng-container matColumnDef="NameUsers">
                <th mat-header-cell *matHeaderCellDef>Имя</th>
                <td mat-cell *matCellDef="let row"> {{row.NameUsers}} </td>
            </ng-container>
            <ng-container matColumnDef="SmallNameUsers">
                <th mat-header-cell *matHeaderCellDef>Сокр. Имя</th>
                <td mat-cell *matCellDef="let row"> {{row.SmallNameUsers}} </td>
            </ng-container>
            <ng-container matColumnDef="IdOtdel">
                <th mat-header-cell *matHeaderCellDef>Ун отдела</th>
                <td mat-cell *matCellDef="let row"> {{row.IdOtdel}} </td>
            </ng-container>
            <ng-container matColumnDef="IdPosition">
                <th mat-header-cell *matHeaderCellDef>Ун должности</th>
                <td mat-cell *matCellDef="let row"> {{row.IdPosition}} </td>
            </ng-container>
            <ng-container matColumnDef="TabelNumber">
                <th mat-header-cell *matHeaderCellDef>Табельный номер</th>
                <td mat-cell *matCellDef="let row"> {{row.TabelNumber}} </td>
            </ng-container>
            <ng-container matColumnDef="StatusActual">
                <th mat-header-cell *matHeaderCellDef>Актуальный статус</th>
                <td mat-cell *matCellDef="let row"> {{row.StatusActual}} </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
        <div *ngIf="dataSource.data.length === 0">Отсутствуют данные!!!</div>
    </div>
    </div>
</mat-tab>
    <mat-tab label="Отделы/Начальники">
        <div class="mat-elevation-z8">
                <form class="search">
                <mat-form-field class="search_blok">
                        <span matPrefix><i class="material-icons">youtube_searched_for</i></span>
                        <input matInput (keyup)="otdel.filterstable($event.target.value)" placeholder="Поиск данных">
                </mat-form-field>
                    <button class="actual" mat-button (click)="excel.ExportTOExcel(tableotdels)">Выгрузить отделы и начальников</button>
                </form>
            <div class="tables" #TABLEOTDELS >     
                <table mat-table [dataSource]="otdel.dataSource">
                    <ng-container matColumnDef="IdOtdel">
                        <th mat-header-cell *matHeaderCellDef>Id</th>
                        <td mat-cell *matCellDef="let row">
                         {{row.IdOtdel}}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="NameOtdel">
                        <th mat-header-cell *matHeaderCellDef>Наименование отдела</th>
                        <td mat-cell *matCellDef="let row">
                        <Label [style.display]="row.ModelIsEdit ? 'none':'block'">{{row.NameOtdel}}</Label> 
                            <mat-form-field class="validation" [style.display]="!row.ModelIsEdit ? 'none':'block'">
                                    <input matInput placeholder="Наименование отдела" [ngModel]="otdel.model?.NameOtdel" (ngModelChange)="otdel.model.NameOtdel = $event"/>
                             </mat-form-field> 
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="NameRuk">
                        <th mat-header-cell *matHeaderCellDef>ФИО Начальника отдела</th>
                        <td mat-cell *matCellDef="let row">
                                <Label [style.display]="row.ModelIsEdit ? 'none':'inline'">{{row.User?.Name}}</Label>
                                <mat-form-field class="validation" [style.display]="!row.ModelIsEdit ? 'none':'block'">
                                        <mat-select (click)="otdel.calbackfiltersAll()"  [placeholder]="otdel.model.User?.Name" [(ngModel)]="otdel.model.User" name="user">
                                          <mat-select-filter class="filter" [placeholder]="otdel.model.User?.Name" [displayMember]="'Name'" [array]="otdel.user" (filteredReturn)="otdel.filteredUser =$event">
                                          </mat-select-filter>
                                            <mat-option [value]='null'>None</mat-option>
                                            <mat-option *ngFor="let user of otdel.filteredUser" [value]="user">
                                                {{user.Name}}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                        </td>
                    </ng-container>

                     <ng-container matColumnDef="ActionsColumn">  
                        <th mat-header-cell *matHeaderCellDef>
                            <button mat-icon-button color="primary" [disabled]="otdel.isAdd" focusable="false" (click)="otdel.add()">
                                <i class="material-icons">person_add</i>
                            </button>
                        </th>
                        <td mat-cell *matCellDef="let row">
                        <button mat-icon-button *ngIf="!row.ModelIsEdit" [disabled]="otdel.isEdit" color="accent" (click)="otdel.edit(row)">
                            <i class="material-icons">edit</i>
                        </button>
                        <div *ngIf="row.ModelIsEdit" >
                                <button  mat-icon-button type="submit" color="primary" focusable="false" (click)="otdel.save()">
                                        <i class="material-icons">check</i>
                               </button>
                               <button mat-icon-button color="primary" focusable="false" (click)="otdel.cancel(row)">
                                    <i class="material-icons">cancel</i>
                                </button>
                        </div>
                     </td>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="otdel.displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: otdel.displayedColumns;"></tr>
                </table>
            </div>
                <mat-paginator #otdels [pageSizeOptions]="[10, 20, 50, paginatorotdels.length]" showFirstLastButtons="true"></mat-paginator>
            </div>
    </mat-tab>
    <mat-tab label="Роли/Доступы"></mat-tab>
</mat-tab-group>